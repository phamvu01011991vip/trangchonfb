<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
100048314087246
100048366393144
100057941141351
100030224104430
100014546863599
100049189093692
100040368743068
100040800502286
100088228870201
100002976918758
100086414321080
100050776668143
100062772435732
100061625302199
100089819139834
100050449147209
100007502857416
100026762477315
100078850015368
100081217430552
100078958613038
100013654566781
100023615856963
100090181341928
100092732245560
100001873408392
100014167006955
100046298491838
100077583201503
100004955957057
100092536762706
100091747625815
100022962079616
100064656570778
100025798989858
100036423422205
100003279484754
100073803132773
100084481196612
100057385545728
100025604715807
100085996274606
100025394432626
100067221924341
100064063332103
100000270170018
100004930363727
100009098930309
100067470804102
100013458602295
100058773316008
100089694184496
1433767736
100014615679667
100093918920344
100054131154461
100039848002041
100005449324573
100030259460957
100056420170593
100074262703184
100063270219790
100013747746011
100068109438891
100025323461160
100056782361815
100005000801746
100050684180082
100001619614415
100004999835543
100016522419990
100008541946161
100077063928610
100095042337168
100051145533563
100055753584550
728286838
100000323153070
100041459556347
100001847296362
1620130291
100025382714613
100013996835762
100053784728703
100001173312586
100010680095927
100000250118240
100002662955446
100014859552558
100075315581865
100091616708926
100014250512157
100066775751384
100086524157476
100011098003892
100031490798959
100078302852035
100094324597927
100007414517501
100045965375049
100065113993226
1634768764
1815388010
100059169922113
100034601347353
100089529258729
100065467877252
100035392449119
100002567228113
100011631582542
100005063343456
100050387889084
100025062144224
100041651799998
100066393887771
100016577774698
100035705482173
100027433400360
100094812537281
100002239249455
100029273017280
100074415282918
100025062678619
100021823746809
100033508081930
100000782766454
100008483059170
100045207255873
100074065789778
100011612139532
100043104377155
1141307894
100072762482211
100066562732937
100007947347293
100070017564795
100018672168837
100073653966502
100055916640230
100016630006672
100011357239306
100088451195221
100092707770850
100089002121180
100081110715917
100002708066640
100000518310234
100009286869361
100002052504937
100017763336825
100017486472591
100039484020757
100086349892352
100013864302185
100010979677203
100048453306691
100081003588618
100091224731417
100081680075082
100012104921979
100045929822378
100083035629905
100052948881073
100074873550505
100003930048633
100073522843454
100005311364849
100056673346786
100006923772376
100002713200928
100024919222230
100068981754805
100012011834232
100001010333774
100070710382639
100082874662780
100073380405742
100052880228309
100086254194990
100082157864058
100073443589882
100003628710430
100065043796067
100002077562099
100085485114674
100005747404216
100073759068228
100016109985197
100011151493459
100004140588707
100012923955919
100010721701888
100076259554249
100006366843376
100000628390337
100000858560398
100006426840601
100070718962805
100008220788135
100002414019300
100003367066902
100013019617899
1186906835
100069748388162
100005028435116
100050866373148
100007816902601
100008196436519
100001809323391
100000673632882
100004882954204
100084210277687
100006672668321
100087000772160
100041740178199
100085632140942
100070061895909
100025931362287
100006855617196
100076213223288
100039786960459
100082532795928
100080227593555
100030094434034
100052472362734
100013473759861
100093982447677
100084327040092
100074065093915
100070603994816
100068029171058
100076564441964
100032975153276
100028866300478
100094437460421
100085066302979
100076323687119
100008347127309
100087819787985
100090811271730
100081654283753
100081213201023
100080231332826
100067473744004
100068584264103
100082088319076
100039232839391
100046614459110
100032850773441
100075559954505
100090559283772
100089471554609
100006212086651
100048421450978
100046067192380
100085435314862
100069102803037
100076225782829
100023550273370
100091887167545
100084903298002
100057563333493
100081042410661
100003180572375
100024382273449
1181717466
100010115555169
100003113157766
100001741167730
100002666955702
100002437282953
1187740854
100005245929756
100009258032735
100008894263143
100002786624803
100001448203214
100015561900080
100042972520857
661918350
100002166510255
100001288089891
100006593868164
100019527903036
100031234533163
100058965877678
100030519580289
100031250701537
100081263794812
100011467117787
100009560460230
100089839614212
100044564672894
100077432442180
100032838879915
100008193588531
100081755191160
100069475736187
100028373613986
100023992750048
100083836507311
100080099655106
100057503209792
100015856996722
100006157455046
100045057132229
100046800273783
100083585053471
100007502986631
100000830741092
100000178032391
1589015710
100001650876000
100008990956354
100069512740569
100077910640056
836065541
100007942840175
100090596064041
100060658403919
100020877425810
100068502736703
100072508980990
100006574119823
100055532187696
100003691869204
100092542354567
100084484411145
100009639711370
100037555815422
100093141651661
100027360652675
100092733684652
100023602042677
100069205085860
100041873627053
100026660440361
100052784836589
100080257444723
100085236155731
100093400969582
100010696900063
100074800149983
100008803723322
100001845496558
100082137381931
100030356071324
100085017452265
100080591525793
100069465602099
100048294960968
100048950896761
100094848372717
100071934562152
100066761767212
100068097660053
100081830345844
100010268315380
100081747394098
100028256640139
100094570754621
100086402629345
100078466441129
100067705722768
100077729492828
100087253354783
100051870524600
100093701976170
100094188497244
100094981210345
100005661228575
100036552113389
100014473454853
100044236335336
100082287462128
100052094112613
100092759058395
100070376090991
100095364550966
100008709009193
100076951072432
100089320727910
100011166166826
100082584884331
100094688831239
100040997867486
100015534129964
100028011489904
100022111621266
100060588222046
100085129060353
100020726288887
100003531710557
100092755840430
100026689683472
100024057617457
100086936893596
100051058084509
100088357493405
100021717135952
100072040261890
100016267535315
100024972553732
100022429597978
100070719725974
100089216857968
100054334401652
100077278065307
100045516071763
100086688847529
100016034532804
100003458244137
100001440108219
100011777121919
100003564697471
100088804101801
100032685136202
100058771641945
100094127049434
100075757222298
100052352855579
100051863370913
100075251964134
100077127145402
100006414219711
100085448701824
100070981036096
100093422476880
100051509624519
100012846103763
100007112649755
100081507631390
100005261775319
100009773024634
100062918317966
100004332276001
100068043821478
614384864
100000456948610
100022842645501
100002840635855
100003821235812
100057740721300
100011617183120
100090508390416
100004054324494
1460512447
100000755701748
100029050819269
100024658212720
100006924401420
100033537970399
100068117896465
100038209973407
100077723061900
100047916992907
100064201810772
100015290683984
100058483844073
100049382739832
100089637845207
100000220882410
100003095365566
1437475303
100001161541834
100008206444461
100005699234355
100006411871705
100005070376043
100004382255011
100004322701897
100071464715156
100058850193271
100069970430703
100003290567089
100069690225362
100069431918254
100000690096560
100050472142469
100007634717192
100005811551795
100006092852627
100001399138638
525972466
100013134336158
100012887618659
100037268140641
100030163653601
100021446688367
100077835567456
100082196674009
100017674608456
884425337
100004578004013
100054175690172
100043860278117
100094939840287
100032654589082
100077645320185
1577776346
100081553184659
100088712105379
100020181025453
100019804494753
100069239456461
100050302372733
100001652094711
100013426718355
100066407741562
100015432167947
100013361582874
100042927000221
100055777936769
100083980633884
100063534247903
100090995683795
100035944713027
100038062176515
100042484342654
100074736752658
100084808994377
100074916751202
100074790290930
100023038934495
100080124649361
100016478825686
100090740905796
100088464786760
100088820677991
100008807382606
100094783434013
100025001201365
100002959287286
100034661753586
100049560096116
100022877164918
100004023573622
100058685172196
100050586018043
100089316548859
100070909782134
100091248280003
100051555853716
100002103370718
100056962093614
100044766393904
100047935421245
100038966104223
100070154689684
100081189421765
100016757462901
100005444958996
100072800967608
100041294589797
100067730001806
100052358182440
100047828661640
100090367901349
100003992835517
100045913852949
100013247917758
100044094052601
100085580512560
100072939673436
100015317861375
100002905669772
100063527370665
100078506260127
100082554683657
100088451493311
100006222764845
100045522961527
100083173031935
100068139630896
100036036633125
100089856760414
100018595786590
100092425100860
100079984851976
100081320696753
100072828380979
100046721105173
100089080542752
100084181370053
100013241794261
100001137601469
100048037126011
100053946424075
100015150161494
100034367170024
100053327382183
100083178062488
100003360151894
100056078461614
100057644076439
100080130053624
100090193093147
100036033485807
100022487252836
100084225229991
100001645450722
100063087306988
100080333451243
100057997653616
100075729633905
100031204264059
100086618064166
100053822328716
100088439944408
100086602246949
100002559801940
100041113634493
100004919089472
100057106275217
100090442881609
100094618906154
100073157312407
100041260545874
100075798105831
100005639465762
100039906521125
100091929500323
100070119818648
1368169417
641507393
100029382373883
1776378857
100000212446602
100007341061314
100086347189683
100005933592194
100005643934103
100020632190946
100045391997021
100067215200555
100075442631013
100013939667439
100009510386810
100089172242730
100005468561043
100073960705830
100075344134299
100090843724289
100005491773866
100054121632679
100022013586954
100094535675386
100014893714617
100084259994704
100042682571412
100054385726882
100036031521800
100019076572939
100011054028568
100044366598686
100007601463110
100033893062538
100030222870582
100093000805084
100026408150198
100057496265010
100019399096950
100073324962526
100083974172117
100021490713834
100093242784150
100021385083427
100081182850828
100074848389708
100076417564361
100007684966249
100095565639934
100067802418254
100088860915486
100010252507472
100068686830333
100062150670993
100038797339080
100042440031506
100025136739133
100002784056863
100022621040860
100016220712058
100041205457403
100026509231390
100054432300123
100075370419127
100011481557074
100080618086237
100028302241004
100003208814578
100034620314195
100048725798351
100008215664725
100022404380385
100038470987751
100041863145782
100068345860094
100072744518348
100005235946064
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm, phạm văn, đức dương, phan kiên, thiện trí, khẩn " />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên"</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>