<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
100084262900332
100094573772624
100092485336912
61552538433006
100091387338132
100091363502101
100086319782699
100084443371594
100090553188878
100085896290670
100084030108440
100089748731055
100083946080277
100083903393408
100084227769399
100086130730809
100086167959634
100084141583516
100084264521790
100083735394559
100084927967298
100085910930300
100083851163759
100086105771602
100084074296194
61566411089075
100084318572161
100083979204231
100083949469976
100085940539021
61566373561021
100092465537696
61552025220520
100091954189917
61552649366513
61552617598296
100084266588226
61552618556734
100092344396714
100089122921918
100084229933461
100075302268282
61559102573264
61557420594637
100084176083231
100090181885944
100084141314851
100085713293243
100092589822700
100083808565841
100084050777760
100084084225685
100088505382109
100084214419960
100084293703319
100084327814292
100084299078718
61566570230915
100084225738963
61552241862592
61552084255787
100085833820026
100089109515519
100088196907435
100092604784924
61557217712108
100084049910601
100084075021986
100086100342765
100084036408060
100085842833618
100083992730109
100084081194848
61559698750268
100085845750609
61556671769473
100088348815355
100083943622751
100084009348216
100084109002727
100084054314998
100086907146261
100084115039197
100084395285349
100084116237216
100083951783465
61552246010049
61551877627660
61552662565927
61555886783451
100092524387981
100090745155977
100090754314410
61552500843332
61552263942333
100084148810771
100083986732043
100084386791410
100085963459539
61552695263867
100084040490554
100092293806334
100094081135169
100084036105794
100083863405741
100090391568310
100093044941150
61553003237873
61552095207454
100092527372187
100089015284699
100086899472106
100084048546808
100091976261354
100094471805712
100084249943390
100083890972120
100091802996039
100092169042868
100084211691381
100091539824029
61552961458215
100090231674378
100091131117056
100091945843772
100094161471859
100092015217272
100093014433793
100087213916090
100094161169581
100092444641205
100086846523232
100090734030493
100086847327917
100094188349713
100087216805228
100094064426487
100087001503308
61566029087391
100088531961022
100091578278524
100084004852072
100083987722331
100094539994427
100084324667329
100086057714292
100092594620321
100086409152968
100094257196608
100079980894867
100084073428617
100090019702887
100094264157418
100080356835569
100094495474731
100084224681869
100083951214715
100088566441790
100084279069763
61560066376834
100094059116685
100082072189075
61551989760514
100084065179903
61552758260592
61552618498395
61551357314563
61552105397759
61566060824480
61566443671934
61552522951969
100084360331623
61556886736002
61566058274846
61552417418330
100085836624016
61566446819833
61556385878569
61557083811622
100088676718443
100082125553161
100084357515898
100084429662752
100084314077556
100084393603546
100084301898852
100094627650084
100083862745763
100088380260250
100085966968374
100084473220586
100084054890242
100084469740430
100086260715067
100086351580996
100084357904978
61557362187261
61565960926350
100087224617601
61552199391949
100083898357352
100090334322221
100084077504954
100088209087512
100084330393862
100085888041130
100084154094096
100083993717809
61566237369323
61566787731593
100086059453626
100086364090174
100091850034669
100080145406384
100075300368892
61556630012535
61556895735269
61552747671336
61552189717831
100083908224125
61552061367329
61555662540228
100086261465284
61556596662645
100090691072130
100092577183823
100091770926887
100084211032306
100092483246057
61576768364704
100084963390342
100092317656894
100092695937138
61552191285184
61552606678951
61552611958495
61551988416050
100086219707543
61552201132014
61551940472048
61552514522555
100094162251171
100094214058586
100094293284668
100094152171745
100092360865883
100091882253099
100094078285781
61557508940533
100092559036077
100092677621252
100087983142195
100087185756398
100090292781570
100084210007679
100090037612398
100084184757616
100084358298196
100090173596658
100090180385642
100083869345611
100090026783410
100086004166235
100092657072104
61556604904486
100084027108609
100092214594093
100090782620791
100092133504888
100092763727734
100092546406732
100092621870522
100084358805183
100084426571820
100086049884824
100092217066117
100090715236239
100090424007152
100090533110299
100083981021593
100090966819955
100090653363531
100090348212839
100084369362423
61566662184835
100089343300508
61566114553698
100084304293886
100086096622724
100084114065335
100087339338566
100092450921248
100087220874936
100088520945622
100089035934687
100083844926631
100090180235450
100090586669564
100088352926117
100089140002981
100090574891916
61563175440141
61566263914335
100084377221860
100083980070555
100082080257026
100084200895844
100085309816750
100088837853769
100090412537365
100084191982198
100084018498709
100084272104483
100084126286802
100084039196929
100094309003704
100091315195244
100086907185597
100086568395176
100085911530457
100084364621252
100083985862895
61566368919282
100084319928957
100084367472496
100083841655408
100092692037313
100089114110666
100084293913319
61565934197498
100086181278709
61559819435723
100085856616530
100084315637738
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm, phạm văn, đức dương, phan kiên, thiện trí, khẩn " />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên"</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>