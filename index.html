<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
100089127993822
100089212419485
100092409873170
100089109515519
100091850034669
100092318616951
100092366315158
100088426093643
100088692767708
61552314670115
61552618556734
61552695263867
61552758260592
61552202842330
61552263942333
61552662565927
61552136537914
61551747674433
61552389967837
61559909552860
61566373561021
61565895585095
61566570230915
61565875004319
61566411089075
61566787731593
61565960926350
61566237369323
61566443671934
61566060824480
61566058274846
61566446819833
61566494069858
61556731319573
61557090127148
61556616333136
61556897364126
61556385878569
61556630012535
61556527391547
61556895735269
61557362187261
61557083811622
61556596662645
61557047843286
61557508940533
61552649366513
61552199391949
61552606678951
61552191285184
61552514522555
61551988416050
61552201132014
61551877627660
61552061367329
100092377864366
100088681750326
100094290284942
100088691392176
100094281015472
100094299555896
100094539994427
100094336932394
100094585830521
100094402059168
100094508791327
100094214058586
100094152171745
100094552832044
100094612080757
100094493616565
100094627650084
100094184361932
100094323254633
100094264157418
100094106186047
100094231729657
100094396241095
100094078285781
100094491305105
100094381150119
100094409918561
100094411448569
100094278045143
100094128862786
100094320703021
100094504084272
100094444986862
100094188349713
100094102074172
100094546592360
100094107294192
100094505794195
100094471805712
100094274805263
100094495474731
100094403948974
100094540832696
100094196539328
100094284284895
100094281854866
100094265805929
100094411148513
100094369180756
100094091004912
100094325562219
100094296884232
100094587270361
100094080625579
100094059116685
100094224318111
100094307055847
100091770926887
100090553188878
100092293806334
100084963390342
100092657072104
100092214594093
100092133504888
100092169042868
100092621870522
100084477146804
100092666468261
100094071567750
100090966819955
100090533110299
100090082948003
100092695937138
100092527372187
100092763727734
100092483246057
100092577183823
100092485336912
100092360865883
100092465537696
100091363502101
100091802996039
100091575969269
100091387338132
100092317656894
100092883698251
100091578278524
100091852133918
100092217066117
100092589822700
100087224087201
100086847327917
100090745155977
100090424007152
100090653363531
100089113780389
100090310266719
100089062692949
100090714801031
100090717006396
100090715236239
100090348212839
100090866804003
100090870078491
100087140364108
100087185756398
100087339338566
100087220874936
100090734030493
100085588502976
100092450921248
100092677621252
100089035934687
100090180235450
100090180385642
100087524691506
100090586669564
100090782620791
100088837853769
100088352926117
100089140002981
100090292781570
100090412537365
100090037612398
100090173596658
100090574891916
100090231674378
100090019702887
100090026783410
100090276163483
100087216805228
100086907146261
100087178316627
6156602095052
61566211775340
61566263914335
100083956364824
100084211691381
100083983105967
100084646980559
100084191982198
100084084225685
100084009348216
100084018498709
100084377221860
100084014621840
100084262900332
100083987722331
100086057714292
100085888041130
100086096622724
100086105771602
100083903393408
100084369362423
100084040490554
100084318572161
100084229933461
100084327814292
100083943622751
100084048546808
100086409152968
100084227769399
100085780615843
100084109002727
100083949469976
100084225738963
100083886656462
100084249943390
100084279069763
100084054890242
100083977133027
100084393603546
100084121307749
100084443371594
100084301898852
100084358805183
100086181278709
100086351580996
100086298693294
100085747736601
100086364090174
100086130730809
100086178819458
100086167959634
100085707387162
100086346331327
100085910930300
100085911530457
100085309816750
100086316962590
100086178279505
100084369062306
100084077504954
100084330393862
100083869345611
100083844926631
100083867185989
100083980070555
100085856616530
100083979204231
100084367472496
100084039196929
100084304293886
100086907185597
100086076962979
100084012759306
61566114553698
61566662184835
100080356835569
100086012225098
100084319928957
100084357515898
100085842833618
100085713293243
100086568395176
100084049910601
100083985862895
100084315637738
100083951214715
100084075021986
100084364621252
100084081194848
100084050777760
100084074296194
100084293913319
100084224681869
100084299078718
100083841655408
100084036408060
100084395285349
100084176083231
100082072189075
100094577790666
100094155863230
100082080257026
100090391568310
100094309003704
100084036105794
100083862745763
100084148810771
100084114065335
100084293703319
100094472135994
61562055295898
61562172865226
100083890972120
100088800271905
100086319782699
61563175440141
61563488333095
61563482062638
100084054314998
100083808565841
100084351540477
100083946080277
100084266588226
100084272104483
61551989760514
100066813912504
100067764049015
61556329457260
61557489560991
61551903036658
61552131917857
100094579680770
100091909758411
100092344396714
100092692080662
100086846523232
100089164383479
61566551633218
100083992730109
100084366934696
61552637727409
61552939589380
61552961458215
100083735394559
100088488885786
61552618498395
100084116237216
61552421676174
100088971968973
61552144554384
100085940539021
100088348815355
61552473786712
61576659345210
61576768364704
100084235001269
100083981021593
61552084255787
100084027108609
100084324667329
100084211032306
100084426571820
100083986732043
100084073428617
100084473220586
100086049884824
100088380260250
100089454000185
100073649287017
61556992180619
100094426267790
100094087255178
100094081135169
100094089145063
100086899472106
100092015217272
100093014433793
100087642327712
100087224617601
100090691072130
100090334322221
100085836624016
61555886783451
100084154094096
100083993717809
100084115039197
61560066376834
61552293638115
61566441058060
100084355683917
100084292836223
100084436951260
100085845750609
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm, phạm văn, đức dương, phan kiên, thiện trí, khẩn, long, hào, cường  " />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên"</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>