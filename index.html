<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
100090160178780
100090264759820
100089313828303
100090027409102
100094915954978
100090122894691
100089990931234
100090114915826
100089676653333
100089942992428
100085904481973
100090091846702
100094885322273
100089844507056
100090442680525
100094956513826
100090073807848
100089523435574
100092093269053
100094481662089
100092297617424
100090047477794
100094572253419
100090508860741
100090363780796
100091654286739
100094481123319
100090403984864
100090161413132
100089861826967
100091988677857
100090181092303
100089233616599
100090111104183
100092529857774
100091905806333
100095604308323
100090441451034
100090312967477
100089969512104
100092302781577
100085492343521
100092264072510
100090420424199
100089846187731
100094737221340
100091674834271
100090944318368
100092353440792
100092030750347
100092027786401
100092586632975
100091801917170
100092206965564
100092212045639
100092320255038
100092327416150
100092332227178
100092333533099
100092399723556
100092426790954
100092430261695
100092438533066
100092455881543
100092535377820
100092550107941
100092569426061
100092839081025
61562722894360
61566195524381
100089823850278
61575630085846
100079311982919
100095493255764
100081089352607
100094636277644
100079030314459
61575222578938
61566506939044
61566834023284
61558335923122
100030855891997
61552600387873
61552483860256
100079630929854
61575289294907
61557064499482
100068983203733
61570707985691
100043406555148
100068705744600
100064196913494
100063462967553
61575227469177
61557662949367
100079058905823
100056252522348
61557450532121
100084239816050
61566392883392
100095400823066
61567118468719
100057451293468
61552392946440
100081459217292
100089130856838
100066590063358
100065431370258
100084017886769
100083977654201
100050350158111
100094473559453
100079551289390
100052060630522
61552757625643
100065787096643
61550834423709
100067111231544
61557265465269
100079235504215
61562785869327
100067703191179
100055226752163
61550012536386
61573999982254
100057522870175
61566121357310
61550605451483
100091812914393
100083526653296
100068159853416
61556921983481
61550711330021
100051065343210
61550001753271
61550719438750
100094195062418
100069944640426
100090676296331
100084001993793
61550272418939
61555970890283
100084676968149
1632236574
100090721443016
100065645536655
1216789142
100081997981806
100083735053981
100082233826341
100067575379982
100076596751666
100092526008785
100085048784474
61558545710738
100072192243244
100088119221097
100092525061103
100082054783163
100062095583464
100069338755044
100026788532852
61556575897716
100087426876609
100067654541481
100015761505951
100028863308150
100061922316748
100021824122473
61575893586383
61552333784072
100049784356074
100051789601339
100081857287951
100080715086671
100044905129282
100036163041647
100034955324661
100056599495688
100064654454338
100063506093889
100089694430615
100089088255074
100015741318568
100092843585763
100024882892333
100092716117188
100028624101292
100028310653740
100026305171192
100023833230246
100024578923294
100005950121019
100016693268938
100006613652602
100001721792970
100008748611906
100027076894963
100013045789365
100002456404713
100009539365930
100021932470458
100073441777154
100040441251568
100001464397705
100014569451092
100000930003262
100011217757159
100048139244249
100049918204730
100068908123478
100055756014504
100049514228205
100076004245606
100034223408195
100057753435772
100072977281524
100066363624250
100053185991741
100071537734300
100067001976268
100041002875263
100077405499538
100088508412954
100039494220639
100070315056066
100036058789951
100051658783238
100071055581081
100069101666504
100074313219461
100010455698598
100072755280298
100029182814240
100071510600606
100060500054456
100058959410936
100071736252710
100040714626581
100036252225914
100036679800732
100054617404105
100046684835964
100051378469938
100063825519024
100052034492551
100031829792712
100089884672949
100059225093370
100059391646376
100077022451263
100051225194958
100053472172491
100040375308696
100060605659772
100050319482569
100068484356287
100035009349457
100040556526599
100035681116800
100033503740590
100069106511506
100037103793454
100090631410834
100047089478903
100054434837082
100049073382690
100061730831399
100052314354129
100046874778628
100059390974615
100045446355611
100086293989332
100050102482614
100071140534887
100076262427760
100069391163092
100059993136905
100070626371204
100052537659210
100065243022673
100070203437970
100041966045766
100076509120784
100041245282591
100092395914244
100055449052111
100065784351285
100063864681674
100079853964412
100045339611664
100061209623728
100034234432677
100056141481882
100076518955354
100025398694769
100025044278608
100010059190624
100078893490171
100042844142951
100034424736857
100021998268643
61576865537705
100052494224500
100070223087807
100034001029314
100030950686576
100014723378437
100024364598631
100015197413162
100028569225935
100061540124755
100029116741542
61559503667472
100027812144979
100004448491778
100026245170577
100054247765733
100044757910400
100026327589468
100076562190634
100009662343786
100058487684886
100025532948702
100085178056064
100021502830131
100047192086577
100022193116365
100071711262198
100084379278459
100084823369316
100092091874147
100089330881242
100021834815251
100027301022008
100017415558435
100014327981468
100009518258631
100016391205339
100071636933468
100014930440315
100089581210311
100068608584423
100030715757144
100005230955147
100069117384479
100003617348241
100049030601275
100077602453183
100004561990880
100067169370318
100027334512203
100092355008888
100088860595426
100033294396451
100002300266227
100000818299720
1786306236
100004415825280
100011463600793
100001737991243
100003999871562
100014555915570
100093907747762
100077632697594
100013701964797
100092664351132
100019045753600
100066544116855
100018841081360
100073691736843
100029198021854
100080316137942
100065147933783
100030433331634
100043000684772
100090417086107
100002240739951
100062285087515
100030520276825
100019547171778
100090839797144
100010929677014
100072373693903
100091259653344
100058006973764
100034457804404
100039760401684
100027300581876
100068257410908
100094369133982
100013045157219
100076455516688
100081594590064
100091865045633
100035909073809
100051521467658
100004104351679
100067081848839
100017736767363
100088380781357
100094302350780
100087458021787
100080697856389
100094304228117
100094304089468
100092968504493
100045288330353
100036239736760
100093801956486
100066987410350
100069722372760
100076655547669
100042394355911
100036943876324
100038405075510
61570250723595
61551057284382
100038128360829
100081383256288
100026489313296
100047902363052
100007512876754
100011469278615
100017241673859
100027078933445
100073563436925
100076192132592
100049664495503
100086571427562
100092266120372
100026016695059
100015984546512
100028032802869
61562030735040
100008172150223
100078132549764
100034934171829
100035416373867
100082216692191
100025619301685
100011113177470
100036339157976
100016294895936
100087045497144
100089693325198
61551783266586
100045464474036
100090272484963
100023482531601
100060102270459
100092648704263
100073055055520
100030758651351
100053332968230
100065626846468
61579816203244
61577495475339
100014806714891
100051276102242
100024605680021
100034230129969
100093641082458
100064046490985
100051617955989
100093436823296
100048513738668
100058635932693
100095223317821
100095428476395
100079478165516
100073099380699
100088165359249
61555461394748
100086229578349
100036583422858
61555689706550
100092569284516
100094600358783
100080984112827
100084388346254
100061528376748
100093229751811
100087974834345
100087046749946
100007900711424
100006799145958
100006758287535
100006681220855
61574936794295
61580937561207
100006827014590
100004028260086
61575197349732
100006811715029
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm, phạm văn, đức dương, phan kiên, thiện trí, khẩn " />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên"</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>